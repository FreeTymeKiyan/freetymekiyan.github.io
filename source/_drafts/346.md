title: 任一View上出现的ClassCastException
tags:
  - Debug
  - Eclipse
  - FACK-Android
  - Java
id: 346
categories:
  - Android
  - 技术实践
date: 2013-01-08 17:02:05
---

## 
	<span style="color:#000000;">背景</span>

	<span style="color:#000000;"><span style="font-size:14px;">今天在调试android程序的时候，出现了莫名其妙的ClassCastException。我只不过是把自定义的位置调到了一个线性布局的后面，再编译运行居然抛出了ClassCastException。无语啊，百思不得其解。</span></span>

## 
	<span style="color:#000000;">探索</span>

	<span style="color:#000000;"><span style="font-size:14px;">我一开始是为了在ViewFlow这个自定义控件里面加上above的属性，让里面的列表控件不被下方的导航栏遮挡。直接加layout_above属性当然不行，这样编译无法通过。需要@id的属性貌似都有这个特点，@id的控件必须在这个控件之前已经出现过，否则编译之后会报找不到资源的错误。![](file:///D:/Download/%E6%9C%AA%E5%91%BD%E5%90%8D.jpg)</span></span>

	<span style="color:#000000;"><span style="font-size:14px;">我把ViewFlow移到了下面，加上了above的属性。编译之后在eclipse中没有报错，但是一运行就报错了。</span></span>

<pre class="brush:java;">
java.lang.RuntimeException: Unable to start activity ComponentInfo{org.dianmobile.droplet/org.dianmobile.droplet.activity.MainActivity}: java.lang.ClassCastException: org.taptwp.android.widget.ViewFlow

Caused by: java.lang.ClassCastException: org.taptwo.android.widget.ViewFlow

at org.dianmobile.droplet.activity.MainActivity.initViews(MainActivty.java:105)</pre>

	<span style="color:#000000;"><span style="font-size:14px;">提示是最奇怪的。我跳转到对应的一行去看，发现是另外一个系统的控件，不是ViewFlow这个控件&hellip;</span></span>

	<span style="color:#000000;"><span style="font-size:14px;">我把这些操作撤销，编译又通过了&hellip;反复试了几次发现不是偶然事件，去掉above直接移动也会出现这种情况。网上搜了一下相关的问题，筛选掉了很多可能的错误，比如说ListView加了Header之后的Adapter会改变。后来看到有的开发者甚至用EditText或者Button这样的系统控件都会出现类似情况，我觉得可能跟我的情况类似了，就尝试了下面总结中的方法。</span></span>

## 
	<span style="color:#000000;">总结</span>

	<span style="color:#000000;"><span style="font-size:14px;">在</span></span>[<span style="color:#0099ff;"><span style="font-size:14px;">StackOverflow</span></span>](http://stackoverflow.com/questions/3838640/android-classcastexception-on-activity-startup)<span style="color:#000000;"><span style="font-size:14px;">上找到的一个解决方法：</span></span>

1.  <span style="color:#000000;"><span style="font-size:14px;">打开AndroidManifest.xml</span></span>
2.  <span style="color:#000000;"><span style="font-size:14px;">找到application标签</span></span>
3.  <span style="color:#000000;"><span style="font-size:14px;">如果有android:name属性的话就把它删掉</span></span>
4.  <span style="color:#000000;"><span style="font-size:14px;">添加属性，android:name=&quot;android.app.Application&quot;</span></span>

	<span style="color:#000000;"><span style="font-size:14px;">问题果真解决了，很神奇，但不知道为什么。</span></span>

	<span style="color:#000000;"><span style="font-size:14px;">有一说是因为在不同的xml控件用了相同的id。实际上onCreate()方法里面调用setContentView()方法就会把控件限定在这个范围了，后面的findViewById()都是在这个View里面找的，除非指定了View。所以我觉得不是这个原因。</span></span>