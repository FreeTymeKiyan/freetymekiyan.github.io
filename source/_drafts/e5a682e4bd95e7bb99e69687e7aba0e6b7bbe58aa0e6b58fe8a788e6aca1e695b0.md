title: 如何给文章添加浏览次数
tags:
  - WordPress
id: 476
categories:
  - Wordpress
  - 技术实践
date: 2013-02-04 11:55:19
---

## 
	<span style="color:#000000;">前言</span>

	<span style="color:#000000;"><span style="font-size:14px;">Wordpress博客有很多可以自定义的地方，仅仅用原生功能是无法满足我的&hellip;早就想给自己的文章加上显示浏览次数的功能，一直不知道怎么搞。这次又开始探索了~</span></span>

## 
	<span style="color:#000000;">探索</span>

	<span style="font-size:14px;"><span style="color:#000000;">Google了一把&ldquo;Wordpress 浏览次数&rdquo;，找到了很多相关的帖子。看了第一页的大部分帖子，发现有的是不用插件实现的，有的用了。作为新手还是不重复发明轮子了，用插件应该会比较简单。推荐得比较多的一款是</span>[<span style="color:#000000;">WP-PostViews</span>](http://lesterchan.net/portfolio/programming/php/)<span style="color:#000000;">，有种鼻祖的感觉&hellip;相信群众的眼睛！</span></span>

	<span style="color:#000000;"><span style="font-size:14px;">下载安装之后，Wordpress的控制台就的设置项里就多了&ldquo;PostViews&rdquo;。这就是插件的设置页面了。选项有这么些：</span></span>

1.  <span style="color:#000000;"><span style="font-size:14px;">Count Views From: 有效浏览次数的来源，包括Everyone 每个人/Guests only 仅访客/Registered users only 仅注册用户</span></span>
2.  <span style="color:#000000;"><span style="font-size:14px;">Exclude Bot Views: 不包括机器人访问，Yes/No</span></span>
3.  <span style="color:#000000;"><span style="font-size:14px;">Views Template: 显示模板，支持%VIEW_COUNT%参数，比如我的是：热度：%VIEW_COUNT% ℃</span></span>
4.  <span style="color:#000000;"><span style="font-size:14px;">Most Viewed Template: 浏览最多模板，支持%VIEW_COUNT%（浏览次数），%POST_TITLE%（文章标题），%POST_EXCERPT%（文章摘要），%POST_CONTENT%（文章内容），%POST_URL%（文章链接）五个参数</span></span>
5.  <span style="color:#000000;"><span style="font-size:14px;">Display Options: 指定浏览次数显示的页面和可以看到的人。包括Home Page首页、Single Posts单篇文章、Pages页面、Archive Pages文章归档页、Search Pages搜索页和Other Pages其他页面。选项有Display to everyone 全部显示/Display to registered users only 只对注册用户显示/Don&#39;t dispaly on xxx 不要在该页显示</span></span>

	<span style="color:#000000;"><span style="font-size:14px;">设置好了之后就要调用the_views()这个函数来获取浏览次数了。为保证不出意外先检查一下这个函数存不存在比较好：</span></span>

<pre class="brush:php;">
&lt;?php if (function_exists(&#39;the_views&#39;)) { the_views(); } ?&gt;</pre>

	<span style="color:#000000;"><span style="font-size:14px;">把这样一句话加到你想显示的位置就行了。</span></span>

	<span style="color:#000000;"><span style="font-size:14px;">我想把浏览次数加到文章标题下方的&ldquo;</span><span style="font-size: 13px;">Published on 2013 年 2 月 3 日,&nbsp;in 代码管理, 技术实践.</span><span style="font-size:14px;">&rdquo;后面。变成&ldquo;Published on 2013 年 2 月 3 日,&nbsp;in 代码管理, 技术实践.&nbsp;热度：47 ℃&rdquo;这样。网上大多数教程没有说清楚，打开single.php加到想加的地方。对于使用了一些非常规主题的人来说（比如说我），基本是起不到自定义效果的。</span></span>

	<span style="color:#000000;"><span style="font-size:14px;">我主题中的single.php：</span></span>

<pre class="brush:php;">
&lt;?php 
/**
* Single template used by Neuro.
*
* Authors: Tyler Cunningham, Trent Lapinski
* Copyright: &copy; 2012
* {@link http://cyberchimps.com/ CyberChimps LLC}
*
* Released under the terms of the GNU General Public License.
* You should have received a copy of the GNU General Public License,
* along with this software. In the main directory, see: /licensing/
* If not, see: {@link http://www.gnu.org/licenses/}.
*
* @package Neuro.
* @since 2.0
*/

	global $options, $ne_themeslug, $post, $sidebar, $content_grid; // call globals
	response_sidebar_init(); // sidebar init
	get_header(); // call header

?&gt;

&lt;div class=&quot;container&quot;&gt;
	&lt;div class=&quot;row&quot;&gt;
		&lt;div class=&quot;wrap&quot;&gt;
			&lt;div class=&quot;row&quot;&gt;
			&lt;?php if ($options-&gt;get($ne_themeslug.&#39;_single_breadcrumbs&#39;) == &quot;1&quot;) { response_breadcrumbs();}?&gt;	
			&lt;/div&gt;
	&lt;!--Begin @Core post area--&gt;
		&lt;?php response_index(); ?&gt;
	&lt;!--End @Core post area--&gt;
		&lt;/div&gt;
	&lt;/div&gt;
&lt;/div&gt;&lt;!--end container--&gt;

&lt;?php get_footer(); ?&gt;</pre>

	<span style="color:#000000;"><span style="font-size:14px;">虽然我不懂php，意思还是能看懂的。关键是response_breadcrumbs()和response_index()。一开始我以为response_breadcumbs()是文章标题下方的内容，去找这个函数里面的内容。结果看着看着就觉得奇怪，突然发现这是页面导航&hellip;回头再找response_index()。从结构上来看，这个函数应该返回了所有文章相关的内容，包括导航以下和页面footer以上的内容。找这个函数里面的内容就行了。</span></span>

	<span style="color:#000000;"><span style="font-size:14px;">在后台的所有php里面找来找去，每个都看了，只发现core-hooks.php里面有这么一句：</span></span>

<pre class="brush:php;">
function response_index() {
	do_action (&#39;response_index&#39;);
}</pre>

	<span style="color:#000000;"><span style="font-size:14px;">跟response_breadcrumbs()里面的内容相去甚远啊！这个do_action到底是什么东西呢？不明白，Google之后还是不明白&hellip;我被迫放弃了直接在后台改这条路，跑到主题当中去找文件。</span></span>

	<span style="color:#000000;"><span style="font-size:14px;">进到wp-content\themes\neuro文件夹中，我一个个的看标题，看到可能的就打开看内容。发现一个single.php，可惜内容和后台看到的一样，不是这个。按倒序排除了licensing、library、includes、images、css文件夹（如果我正着看早就找到了╮(╯▽╰)╭），只剩core了。一进到core里面就发现了actions这个文件夹，我的直觉告诉我应该在这里。打开之后果然是各种xxx-actions.php文件，比如404-actions.php，archive-actions.php，callout-actions.php等等等等。大多数看标题就知道意思了，而且还都不是我想找的&hellip;又看了一遍发现了global-actions.php。global是干啥的？既然其他都明显不是了，看看这个是不是。</span></span>

	<span style="color:#000000;"><span style="font-size:14px;">global-actions.php里面一进来就有这样几行</span></span>

<pre class="brush:php;">
add_action( &#39;response_loop&#39;, &#39;response_loop_content&#39; );
add_action( &#39;response_post_byline&#39;, &#39;response_post_byline_content&#39; );
add_action( &#39;response_edit_link&#39;, &#39;response_edit_link_content&#39; );
add_action( &#39;response_post_tags&#39;, &#39;response_post_tags_content&#39; );
add_action( &#39;response_post_bar&#39;, &#39;response_post_bar_content&#39; );</pre>

	<span style="color:#000000;"><span style="font-size:14px;">看到第二个的时候我笑了。我记得在后台设置的时候post_by_line_elements就是说的文章标题下面的内容。小样，找到你了吧！</span></span>

	<span style="color:#000000;"><span style="font-size:14px;">打开搜索功能跳转到了function response_post_byline_content()</span></span>

<pre class="brush:php;">
/**
* Sets the post byline information (author, date, category). 
*
* @since 1.0
*/
function response_post_byline_content() {
	global $options, $ne_themeslug; //call globals.  
	if (is_single()) {
		$hidden = $options-&gt;get($ne_themeslug.&#39;_single_hide_byline&#39;); 
	}
	elseif (is_archive()) {
		$hidden = $options-&gt;get($ne_themeslug.&#39;_archive_hide_byline&#39;); 
	}
	else {
		$hidden = $options-&gt;get($ne_themeslug.&#39;_hide_byline&#39;); 
	}?&gt;

	&lt;div class=&quot;meta&quot;&gt;
		&lt;?php if (($hidden[$ne_themeslug.'_hide_date']) != &#39;0&#39;):?&gt; &lt;?php _e( &#39;Published on&#39;, &#39;response&#39; ); ?&gt; &lt;a href=&quot;&lt;?php the_permalink() ?&gt;&quot;&gt;&lt;?php echo get_the_date(); ?&gt;&lt;/a&gt;,&lt;?php endif;?&gt;
		&lt;?php if (($hidden[$ne_themeslug.'_hide_author']) != &#39;0&#39;):?&gt;&lt;?php _e( &#39;by&#39;, &#39;response&#39; ); ?&gt; &lt;?php the_author_posts_link(); ?&gt; &lt;?php endif;?&gt; 
		&lt;?php if (($hidden[$ne_themeslug.'_hide_categories']) != &#39;0&#39;):?&gt;&lt;?php _e( &#39;in&#39;, &#39;response&#39; ); ?&gt; &lt;?php the_category(&#39;, &#39;) ?&gt;.&lt;?php endif;?&gt;

	&lt;/div&gt; &lt;?php
}</pre>

	<span style="color:#000000;"><span style="font-size:14px;">看到&lt;div class=&quot;meta&quot;&gt;这块，有Published on和get_the_date()函数，有by和the_author_posts_link()函数，有in和the_category(&#39;, &#39;)函数，这还不明显吗！果断在后面加上了&lt;?php if (function_exists(&#39;the_views&#39;)) { the_views(); } ?&gt;，保存上传。</span></span>

	<span style="color:#000000;"><span style="font-size:14px;">打开文章看效果，搞定收工！</span></span>

## 
	<span style="color:#000000;">总结</span>

	<span style="color:#000000;"><span style="font-size:14px;">中途有好几次想放弃问懂行的朋友，幸好最后还是坚持下来了。用别人的模板就是麻烦。还好具备一定的理解代码的能力，否则就是看天书了。</span></span>

	<span style="color:#000000;"><span style="font-size:14px;">给文章添加浏览次数步骤如下：</span></span>

1.  <span style="color:#000000;"><span style="font-size:14px;">下载安装WP-PostViews</span><span style="font-size:14px;">插件</span></span>
2.  <span style="color:#000000;"><span style="font-size:14px;">设置你想要的格式，如：热度：%VIEW_COUNT% ℃</span></span>
3.  <span style="color:#000000;"><span style="font-size:14px;">在恰当的地方调用函数显示出来<span style="font-size:14px;">​</span></span></span>

	<span style="color:#000000;"><span style="font-size:14px;"><span style="font-size:14px;">​我觉得，为了Wordpress我肯定会自学php和css的&hellip;</span></span><span style="font-size: 14px; line-height: 1.6em;">​</span></span>