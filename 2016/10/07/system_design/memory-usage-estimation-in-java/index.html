
 <!DOCTYPE HTML>
<html lang="default">
<head>
  <meta charset="UTF-8">
  
    <title>Memory Usage Estimation in Java | Better Programmer</title>
    <meta name="viewport" content="width=device-width, initial-scale=1,user-scalable=no">
    
    <meta name="author" content="FreeTymeKiyan">
    
    <meta name="description" content="I mentioned in the previous post that memory usage estimation is also very important when it comes to evaluate a design. And I was impressed deeply by">
    
    
    
    <meta name="twitter:card" content="summary" />
    <meta name="twitter:site" content="FreeTymeKiyan" />
    <meta name="twitter:title" content="Memory Usage Estimation in Java | Better Programmer" />
      
    
    
    <link rel="alternative" href="/atom.xml" title="Better Programmer" type="application/atom+xml">
    
    
    <link rel="icon" href="/img/favicon.ico">
    
    
    <link rel="apple-touch-icon" href="/img/logo_apple.png">
    <link rel="apple-touch-icon-precomposed" href="/img/logo_apple.png">
    
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.5.0/css/font-awesome.min.css">
    <link rel="stylesheet" href="/css/style.css">
</head>

  <body>
    <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<script>
  (adsbygoogle = window.adsbygoogle || []).push({
    google_ad_client: "ca-pub-3830008196770332",
    enable_page_level_ads: true
  });
</script>
    <header>
      <div>
  
    <div id="imglogo">
      <a href="/"><img src="/img/logo.png" alt="Better Programmer" title="Better Programmer"/></a>
    </div>
    
    <div id="textlogo">
      <h1 class="site-name"><a href="/" title="Better Programmer">Better Programmer</a></h1>
      <h2 class="blog-motto">Where best programming happens</h2>
    </div>
    <div class="navbar"><a class="navbutton navmobile" href="#" title="Menu">
    </a></div>
    <nav class="animated">
      <ul>
        <ul>
         
          <li><a href="/words">Words</a></li>
        
          <li><a href="/about">About</a></li>
        
        <li>
        
        <form class="search" action="/search/index.html" method="get" accept-charset="utf-8">
          <label>Search</label>
          <input type="search" id="search" autocomplete="off" name="q" maxlength="20" placeholder="Search" />
        </form>
        
        </li>
      </ul>
    </nav>
</div>
    </header>
    <div id="container">
      <div id="main" class="post" itemscope itemprop="blogPost">
	<article itemprop="articleBody"> 
		<header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2016/10/07/system_design/memory-usage-estimation-in-java/" title="Memory Usage Estimation in Java" itemprop="url">Memory Usage Estimation in Java</a>
  </h1>
  <p class="article-author">By
       
		<a href="http://blog.kiyanpro.com/about" title="FreeTymeKiyan" target="_blank" itemprop="author">FreeTymeKiyan</a>
		
  
  <p class="article-time">
    <time datetime="2016-10-08T07:06:23.000Z" itemprop="datePublished">Published on Oct 7 2016</time>
  </p>
  
  <p class="article-read-time">
    <span class="post-count">2,659 words in 17 minutes</span>
  </p>
</header>
	<div class="article-content">
		
		
		<div id="toc" class="toc-article">
			<strong class="toc-title">Contents</strong>
		
			<ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#Premises"><span class="toc-number">1.</span> <span class="toc-text">Premises</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Baiscs"><span class="toc-number">2.</span> <span class="toc-text">Baiscs</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Primitives"><span class="toc-number">2.1.</span> <span class="toc-text">Primitives</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Objects"><span class="toc-number">2.2.</span> <span class="toc-text">Objects</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Examples"><span class="toc-number">2.2.1.</span> <span class="toc-text">Examples</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Linked-lists"><span class="toc-number">2.3.</span> <span class="toc-text">Linked lists</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Arrays"><span class="toc-number">2.4.</span> <span class="toc-text">Arrays</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Array-of-Primitives"><span class="toc-number">2.4.1.</span> <span class="toc-text">Array of Primitives</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Array-of-Objects"><span class="toc-number">2.4.2.</span> <span class="toc-text">Array of Objects</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Multi-dimensional-Array"><span class="toc-number">2.4.3.</span> <span class="toc-text">Multi-dimensional Array</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Strings"><span class="toc-number">2.5.</span> <span class="toc-text">Strings</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Summary"><span class="toc-number">3.</span> <span class="toc-text">Summary</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#References"><span class="toc-number">4.</span> <span class="toc-text">References</span></a></li></ol>
		
		</div>
		
		<p>I mentioned in the previous post that memory usage estimation is also very important when it comes to evaluate a design. And I was impressed deeply by my two former tech leads when they do a quick estimate of my proposal on a small piece of paper, or even with just a mental calculation. Now it is the time for me to grasp the gist behind.  </p>
<h2 id="Premises"><a href="#Premises" class="headerlink" title="Premises"></a>Premises</h2><p>The actual memory calculation can be very complicated in terms of implementation, synchronization, and etc. Take Java as an example. Java is implemented on a very wide range of computational devices, and memory consumption is implementation-dependent. So there is no guarantee that the memory usage is same for all of those devices. And If an object’s synchronization lock is contented, or the object is under garbage collection, the usage would not be the same.  </p>
<p>So what we are going to discuss are based on these following premises:   </p>
<ol>
<li>Memory usage in general conditions  </li>
<li>For Java only  </li>
<li>Heap memory, not stack memory  </li>
<li>64-bit machine, which means that 8 bytes are needed to represent addresses  </li>
</ol>
<p>Many older machines use a 32-bit architecture. I also read some older posts based on it. In this situation, the only difference is that each machine address is just 4 bytes.   </p>
<h2 id="Baiscs"><a href="#Baiscs" class="headerlink" title="Baiscs"></a>Baiscs</h2><p>Here comes the very basic idea. Almost the same as time cost estimation: </p>
<ol>
<li>Know typical memory usage in Java  </li>
<li>Decompose a design into these basic usages  </li>
</ol>
<p>This post mainly focuses on the typical memory usage in Java and will not cover any decomposition, because once we have the design, it would be fairly simple for us to come up with the count of each usage.  </p>
<h3 id="Primitives"><a href="#Primitives" class="headerlink" title="Primitives"></a>Primitives</h3><p>First and foremost, let us take a look at the memory requirements for primitive types.   </p>
<p>Table 1.1 Typical Memory Requirements for Java Primitive Types  </p>
<table>
<thead>
<tr>
<th style="text-align:left">type</th>
<th style="text-align:center">bytes</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">boolean</td>
<td style="text-align:center">1</td>
</tr>
<tr>
<td style="text-align:left">byte</td>
<td style="text-align:center">1</td>
</tr>
<tr>
<td style="text-align:left">char</td>
<td style="text-align:center">2</td>
</tr>
<tr>
<td style="text-align:left">short</td>
<td style="text-align:center">2</td>
</tr>
<tr>
<td style="text-align:left">int</td>
<td style="text-align:center">4</td>
</tr>
<tr>
<td style="text-align:left">float</td>
<td style="text-align:center">4</td>
</tr>
<tr>
<td style="text-align:left">long</td>
<td style="text-align:center">8</td>
</tr>
<tr>
<td style="text-align:left">double</td>
<td style="text-align:center">8</td>
</tr>
</tbody>
</table>
<p>A problem one may have is that why boolean consumes 1 byte, since the information can be expressed well with a single bit. This is because computers access memory one byte at a time. It would be awkward if we had to cope with sub-byte offsets for certain fields, and it would require extra logic to read/write individual bits at a given position rather than just the whole byte each time the boolean was accessed.  </p>
<p>Why is <code>int</code> 4 bytes? Since the Java <code>int</code> data type is the set of integer values between -2,147,483,648 and 2,147,483,647(2^31), a grand total of 2^32 different values, typical Java implementations use 32 bits to represent int values.  </p>
<p>If we know the amount of memory available, we can calculate limitations from these values. Just a simple division. For example, if we have 1GB of memory on our computer (1G = 10^9 or 2^30), we cannot put more than about <code>2^30 / 4 = 2^28 = 2^8 * 2^20 = 256 million</code> int values or 128 million double values in memory at any time.   </p>
<h3 id="Objects"><a href="#Objects" class="headerlink" title="Objects"></a>Objects</h3><p>In general, the heap memory used by a Java object consists of:  </p>
<ul>
<li>an object header, consisting of a few bytes of “housekeeping” information  </li>
<li>memory for primitive fields  </li>
<li>memory for reference fields  </li>
<li>padding  </li>
</ul>
<p>To determine the memory usage of an object, we add the amount of memory used by those cases above. Let us figure out each part of them.  </p>
<p>The first one is the header. What is the “housekeeping” information? It includes a reference to the object’s class, garbage collection information, and synchronization information. Typically 16 bytes.   </p>
<p>We already mentioned the memory consumption for each primitive fields. The total memory is a sum of each primitive field. E.g, if an object contains only two primitive fields, which are <code>int</code>, they will cost 8 bytes.  </p>
<p>Reference fields are actually pointers to other objects. This “pointer” is just a memory address, thus uses 8 bytes of memory.  </p>
<p>What is padding then? The memory usage is padded to be a multiple of 8 bytes for a 64-bit machine. We can take it as a few “wasted” unused bytes after the object data, to make every object start at an address that is a convenient multiple of bytes and reduce the number of bits required to represent a pointer to an object.  </p>
<h4 id="Examples"><a href="#Examples" class="headerlink" title="Examples"></a>Examples</h4><p>How many bytes does an Integer object use? We know that Integer is a wrapper of int and that is its only primitive field, 4 bytes. Then as an object there will be a header of 16 bytes. So 20 bytes in total? No. Do not forget about the padding. We still need a few bytes to reach the closest multiple of 8, which is 24. So 4 bytes of padding should be added and the result is:  </p>
<p><code>16 bytes of overhead + 4 bytes int + 4 bytes padding = 24 bytes</code>  </p>
<p>How about a Date object then? Similarly, the result consists of an overhead, the three int fields (day, month, year), and a padding.   </p>
<p><code>16 bytes of overhead + 3 * 4 bytes int + 4 bytes padding = 32 bytes</code>  </p>
<p>How about the <code>Counter</code> class below which also has a reference to a String?  </p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Counter</span> </span>&#123;</div><div class="line">    String s;</div><div class="line">    <span class="keyword">int</span> c;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>According to our general rule, the result now not only contains an overhead and an int field, but a reference to another object as well. That is: </p>
<p><code>16 bytes of overhead + 4 bytes int + 8 bytes of reference + 4 bytes padding = 32 bytes</code>  </p>
<p>When we account for the memory for a reference, we account separately for the memory for the object itself, so this total does not count the memory for the String value.  </p>
<h3 id="Linked-lists"><a href="#Linked-lists" class="headerlink" title="Linked lists"></a>Linked lists</h3><p>A speical case is when there is an inner class in the object. A nested non-static (inner) class requires an extra 8 bytes of overhead for a reference to the enclosing instance.   </p>
<p>For example, suppose we have a stack with N integers built with a linked-list representation like below:   </p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Stack</span>&lt;<span class="title">Integer</span>&gt; <span class="keyword">implements</span> <span class="title">Iterable</span>&lt;<span class="title">Integer</span>&gt; </span>&#123;</div><div class="line">    <span class="keyword">private</span> Node first;   <span class="comment">// top of stack (most recently added node)</span></div><div class="line">    <span class="keyword">private</span> <span class="keyword">int</span> N;        <span class="comment">// number of items</span></div><div class="line">    <span class="keyword">private</span> <span class="class"><span class="keyword">class</span> <span class="title">Node</span> </span>&#123;  <span class="comment">// nested class to define nodes</span></div><div class="line">        Integer i;</div><div class="line">        Node next;</div><div class="line">    &#125;</div><div class="line">    ...</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>How many bytes does it use? In addition to the usual 16 bytes for object overhead for Stack, it also has 8 bytes for its reference to Node, 4 for the int N, 4 for padding. That is 32 bytes. And for each entry, it contains a Node and an Integer. A Node class takes 40 bytes, including 16 bytes overhead, 8 bytes to Integer i, 8 bytes to the next Node, and an extra 8 bytes overhead to the enclosing instance (Integer i). Plus an Integer takes 24 bytes. So it costs 64 bytes for each entry. The grand total is 32 + 64N bytes.   </p>
<h3 id="Arrays"><a href="#Arrays" class="headerlink" title="Arrays"></a>Arrays</h3><p>Now we already know how to estimate the memory usage of a single object, what if we put these object together in an array or a collection?  </p>
<p>First we need to know the how arrays are implemented in Java. Arrays in Java are implemented as objects, with some extra overhead for the length. So an array itself takes:  </p>
<p><code>16 bytes of overhead + 4 bytes length + 4 bytes padding = 24 bytes</code>  </p>
<p>Besides, the memory needed to store the values in the array should be included. It is different in terms of the types of the value.  </p>
<h4 id="Array-of-Primitives"><a href="#Array-of-Primitives" class="headerlink" title="Array of Primitives"></a>Array of Primitives</h4><p>For primitive types all we need to do is multiplying the length of the array by the bytes used by that type. For example, an array of N int values uses 24 + 4N bytes (then rounded up to be a multiple of 8), and an array of N double values uses 24 + 8N bytes (no padding needed, already a multiple of 8).  </p>
<h4 id="Array-of-Objects"><a href="#Array-of-Objects" class="headerlink" title="Array of Objects"></a>Array of Objects</h4><p>An array of objects is an array of references to the objects, so we also need to add the space for the references to the space required for the objects. For instance, an array of N Date objects uses 24 bytes (array overhead) plus 8N bytes (references) plus 32 bytes for each object, for a grand total of 24 + 40N bytes.  </p>
<h4 id="Multi-dimensional-Array"><a href="#Multi-dimensional-Array" class="headerlink" title="Multi-dimensional Array"></a>Multi-dimensional Array</h4><p>Multi-dimensional array is a little more complicated. When we estimate, we should decompose the usage into two parts: 1) the outer array 2) the inner array or the values.  </p>
<p>Let us start with a two-dimensional array first. What is the implementation? A two-dimensional array is an array of arrays and each array is an object.  </p>
<p>Suppose we have an M-by-N array of double values. The outer array uses 24 bytes overhead plus 8M bytes references to the each array object. Then for the M inner arrays, each of them has 24 bytes overhead plus N times 8 bytes for the N double values. The grand total is: </p>
<p><code>24 bytes overhead + 8M bytes references + M * (24 bytes overhead + 8N bytes double) = 8MN + 32M + 24 ~ 8MN bytes</code>  </p>
<p>What if the array entries are objects? First, we replace the cost of double values with the cost of references to the objects, which happens to be the same and leads to a total of 8MN + 32M + 24 ~ 8MN bytes for the array of arrays filled with references to objects. Then we add up the memory for the objects themselves.  </p>
<p>For arrays of more than two dimensions, the above logic repeats: each row of the “outer” array is now an array of references to a further array, which contains the actual primitive data (or references if it is an object array).  </p>
<h3 id="Strings"><a href="#Strings" class="headerlink" title="Strings"></a>Strings</h3><p>We put String after array as we know the implementation of String contains an array of <code>char</code> primitives. The standard String representation (used in Java 7 and after) has two instance variables: a reference to a character array value[] that stores the sequence of characters and an int value hash that stores a hash code that saves recomputation in certain circumstances.   </p>
<p>How many bytes does a String of length N use then? For the String object itself, it consists of an overhead, a reference to the array, an int field, and a padding. In total:   </p>
<p><code>16 bytes overhead + 8 bytes reference + 4 bytes int + 4 bytes padding = 32 bytes</code>  </p>
<p>Besides that, we need to include the memory used by the array, which is an array of N characters. It contains a 24 bytes overhead and N * 2 bytes char primitives. So the grand total is:   </p>
<p><code>32 bytes + (24 + 2N) bytes = 56 + 2N bytes</code>  </p>
<p>The implementation was different in Java 6 and earlier versions. An alternate String representation maintains two extra int instance variables, offset and count, and represents the sequence of characters value[offset] through value[offset + count - 1]. Now, a String of length N typically uses 40 bytes for the String object plus 24 + 2N bytes (for the character array) for a total of 64 + 2N bytes. This representation saves memory when extracting substrings because two String objects can share the same underlying character array.   </p>
<h2 id="Summary"><a href="#Summary" class="headerlink" title="Summary"></a>Summary</h2><p>In this post, we introduced the step-by-step method to estimate memory usage in Java. The first thing is to know the some basic numbers for simple situations like primitive types and single object. Then we dive deeper into more complex cases, such as inner classes and arrays. Building on that, we turn to a widely used special object, String, to estimate its usage.  </p>
<p>Still, we can do this fairly quick on the back of an envelope or on a piece of small post-it paper. And memory usage estimation is actually easier than time cost estimation, primarily because not as many program statements are involved (just declarations) and because the analysis reduces complex objects to the primitive types, whose memory usage is well-defined and simple to understand: we can count up the number of variables and weight them by the number of bytes according to their type.  </p>
<p>Of course, for most of the times, we care more about time cost and ignore memory usage. But, again, for a performance critical system, we need to make sure both time and memory consumption are acceptable for now and the future. Memory is cheap nowadays, but it is not free. In fact, none of the resources are free. Hope that we can grasp the estimation methods of these resources and make the best use of them.  </p>
<h2 id="References"><a href="#References" class="headerlink" title="References"></a>References</h2><ol>
<li>Chapter 1.4 Analysis of Algorithms, Algorithms, 4th Edition  </li>
<li><a href="http://www.javamex.com/tutorials/memory/object_memory_usage.shtml" target="_blank" rel="external">Memory usage of Java objects: general guide, javamex.com</a>  </li>
<li><a href="http://www.javamex.com/tutorials/memory/string_memory_usage.shtml" target="_blank" rel="external">Memory usage of Java Strings and string-related objects, javamex.com</a>  </li>
<li><a href="http://www.javamex.com/tutorials/memory/array_memory_usage.shtml" target="_blank" rel="external">How to calculate the memory usage of a Java array, javamex.com</a>  </li>
</ol>
  
	</div>
		<footer class="article-footer clearfix">
<div class="article-license">
  <div class="centered">
    <img src="http://i.creativecommons.org/l/by-nc-sa/3.0/88x31.png" /> 
    <p>
    This post by <a href="http://freetymekiyan.github.io/">Yang Liu</a> is licensed under <a href="http://creativecommons.org/licenses/by-nc-sa/4.0/">Creative Commons Attribution-NonCommercial-ShareAlike 4.0 International</a>.<br> Please NOTE THE ORIGIN for Reproduction, Copying or other usages.
    </p>
  </div>
</div>


<div class="article-categories">
  <span></span>
  <a class="article-category-link" href="/categories/Coding/">Coding</a>
</div>


  <div class="article-tags">
  
  <span></span> <a href="/tags/System-Design/">System Design</a><a href="/tags/Notes/">Notes</a>
  </div>




<div class="article-share" id="share">

  <div data-url="http://blog.kiyanpro.com/2016/10/07/system_design/memory-usage-estimation-in-java/" data-title="Memory Usage Estimation in Java | Better Programmer" data-tsina="2090687247" class="share clearfix">
  </div>

</div>
</footer>   	       
	</article>
	
<nav class="article-nav clearfix">
 
 <div class="prev" >
 <a href="/2016/11/27/ad-concepts/" title="Concepts in Online Ads Industry">
  <strong>Prev:</strong><br/>
  <span>
  Concepts in Online Ads Industry</span>
</a>
</div>


<div class="next">
<a href="/2016/09/21/system_design/back-of-the-envelope-calculation/"  title="Back of the Envelope Calculation">
 <strong>Next:</strong><br/> 
 <span>Back of the Envelope Calculation
</span>
</a>
</div>

</nav>

	

<section class="comment">
  <div id="disqus_thread">
    <noscript>Please enable JavaScript to view the <a href="//disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
  </div>
</section>

</div>  
      <div class="openaside"><a class="navbutton" href="#" title="Show Sidebar"></a></div>

  <div id="toc" class="toc-aside">
  <strong class="toc-title">Contents</strong>
 
 <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#Premises"><span class="toc-number">1.</span> <span class="toc-text">Premises</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Baiscs"><span class="toc-number">2.</span> <span class="toc-text">Baiscs</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Primitives"><span class="toc-number">2.1.</span> <span class="toc-text">Primitives</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Objects"><span class="toc-number">2.2.</span> <span class="toc-text">Objects</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Examples"><span class="toc-number">2.2.1.</span> <span class="toc-text">Examples</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Linked-lists"><span class="toc-number">2.3.</span> <span class="toc-text">Linked lists</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Arrays"><span class="toc-number">2.4.</span> <span class="toc-text">Arrays</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Array-of-Primitives"><span class="toc-number">2.4.1.</span> <span class="toc-text">Array of Primitives</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Array-of-Objects"><span class="toc-number">2.4.2.</span> <span class="toc-text">Array of Objects</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Multi-dimensional-Array"><span class="toc-number">2.4.3.</span> <span class="toc-text">Multi-dimensional Array</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Strings"><span class="toc-number">2.5.</span> <span class="toc-text">Strings</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Summary"><span class="toc-number">3.</span> <span class="toc-text">Summary</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#References"><span class="toc-number">4.</span> <span class="toc-text">References</span></a></li></ol>
 
  </div>

<div id="asidepart">
<div class="closeaside"><a class="closebutton" href="#" title="Hide Sidebar"></a></div>
<aside class="clearfix">

  
<div class="categorieslist">
  <p class="asidetitle">Categories</p>
    <ul>
    
      
    
      
    
      
        <li><a href="/categories/Coding/" title="Coding">Coding<sup>30</sup></a></li>
      
    
      
    
      
    
      
        <li><a href="/categories/People/" title="People">People<sup>1</sup></a></li>
      
    
      
    
      
    
      
    
      
        <li><a href="/categories/Translation/" title="Translation">Translation<sup>24</sup></a></li>
      
    
      
    
      
        <li><a href="/categories/Words/" title="Words">Words<sup>4</sup></a></li>
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
    </ul>
</div>


  <div class="rsspart">
	<a href="/atom.xml" target="_blank" title="rss">RSS</a>
</div>

  
<div class="tagslist">
  <p class="asidetitle">Tags</p>
    <ul class="clearfix">
    
      
        <li><a href="/tags/Notes/" title="Notes">Notes<sup>26</sup></a></li>
      
    
      
        <li><a href="/tags/Kai-Fu-Lee/" title="Kai Fu Lee">Kai Fu Lee<sup>24</sup></a></li>
      
    
      
        <li><a href="/tags/LinkedIn/" title="LinkedIn">LinkedIn<sup>24</sup></a></li>
      
    
      
        <li><a href="/tags/Java/" title="Java">Java<sup>14</sup></a></li>
      
    
      
        <li><a href="/tags/Elasticsearch/" title="Elasticsearch">Elasticsearch<sup>4</sup></a></li>
      
    
      
        <li><a href="/tags/Thoughts/" title="Thoughts">Thoughts<sup>3</sup></a></li>
      
    
      
        <li><a href="/tags/Pro-tips/" title="Pro-tips">Pro-tips<sup>3</sup></a></li>
      
    
      
        <li><a href="/tags/System-Design/" title="System Design">System Design<sup>3</sup></a></li>
      
    
      
        <li><a href="/tags/Node-js/" title="Node.js">Node.js<sup>3</sup></a></li>
      
    
      
        <li><a href="/tags/Hexo/" title="Hexo">Hexo<sup>1</sup></a></li>
      
    
      
        <li><a href="/tags/Android/" title="Android">Android<sup>1</sup></a></li>
      
    
      
        <li><a href="/tags/TextMate-2/" title="TextMate 2">TextMate 2<sup>1</sup></a></li>
      
    
      
        <li><a href="/tags/Interview/" title="Interview">Interview<sup>1</sup></a></li>
      
    
      
        <li><a href="/tags/Algorithms/" title="Algorithms">Algorithms<sup>1</sup></a></li>
      
    
      
        <li><a href="/tags/Test/" title="Test">Test<sup>1</sup></a></li>
      
    
      
    
      
    
      
    
      
    
      
    
    </ul>
</div>


  <div class="adlist">
  <p class="asidetitle">Google Ads</p>
  <div class="ad">
    <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
    <!-- Hexo blog widget -->
    <ins class="adsbygoogle"
         style="display:block"
         data-ad-client="ca-pub-3830008196770332"
         data-ad-slot="2210281201"
         data-ad-format="auto"></ins>
    <script>
    (adsbygoogle = window.adsbygoogle || []).push({});
    </script>
  </div>
</div>


  
  <div class="archiveslist">
    <p class="asidetitle"><a href="/archives">Archives</a></p>
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/11/">November 2016</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/10/">October 2016</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/09/">September 2016</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/04/">April 2016</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/03/">March 2016</a><span class="archive-list-count">14</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/02/">February 2016</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/10/">October 2015</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/03/">March 2015</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2014/12/">December 2014</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2014/11/">November 2014</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2014/10/">October 2014</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2014/08/">August 2014</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2014/07/">July 2014</a><span class="archive-list-count">6</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2014/06/">June 2014</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2013/08/">August 2013</a><span class="archive-list-count">5</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2013/07/">July 2013</a><span class="archive-list-count">11</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2013/05/">May 2013</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2012/11/">November 2012</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2012/10/">October 2012</a><span class="archive-list-count">4</span></li></ul>
  </div>


  <div class="linkslist">
  <p class="asidetitle">Links</p>
    <ul>
      <li><a href="http://hijiangtao.github.io/" target="_blank" title="JiangTao">Data.Blog</a></li>
      <li><a href="https://modulus.io/" target="_blank" title="Modulus, Node.js Host Provider.">Modulus</a></li>
    </ul>
</div>


  
  <div class="tagcloudlist">
    <p class="asidetitle">Tag Cloud</p>
    <div class="tagcloudlist clearfix">
       <a href="/tags/Algorithms/" style="font-size: 10px;">Algorithms</a> <a href="/tags/Android/" style="font-size: 10px;">Android</a> <a href="/tags/Elasticsearch/" style="font-size: 14px;">Elasticsearch</a> <a href="/tags/Hexo/" style="font-size: 10px;">Hexo</a> <a href="/tags/Interview/" style="font-size: 10px;">Interview</a> <a href="/tags/Java/" style="font-size: 16px;">Java</a> <a href="/tags/Kai-Fu-Lee/" style="font-size: 18px;">Kai Fu Lee</a> <a href="/tags/LinkedIn/" style="font-size: 18px;">LinkedIn</a> <a href="/tags/Node-js/" style="font-size: 12px;">Node.js</a> <a href="/tags/Notes/" style="font-size: 20px;">Notes</a> <a href="/tags/Pro-tips/" style="font-size: 12px;">Pro-tips</a> <a href="/tags/System-Design/" style="font-size: 12px;">System Design</a> <a href="/tags/Test/" style="font-size: 10px;">Test</a> <a href="/tags/TextMate-2/" style="font-size: 10px;">TextMate 2</a> <a href="/tags/Thoughts/" style="font-size: 12px;">Thoughts</a>
    </div>
  </div>


</aside>
</div>
    </div>
    <footer><div id="footer" >
  
  <div class="line">
    <span></span>
    
    <a href="http://weibo.com/2090687247" target="_blank"><div class="author"></div></a>
    
  </div>
  
  
  <section class="info">
    <p> This is FreeTymeKiyan&#39;s blog.<br/>
      He always asks himself, how far can an indie programmer go? Definitely no limit on that.</p>
  </section>
   
  <div class="social-font" class="clearfix">
    
    <a href="http://weibo.com/2090687247" target="_blank" class="icon-weibo" title="weibo"></a>
    
    
    <a href="https://github.com/FreeTymeKiyan" target="_blank" class="icon-github" title="github"></a>
    
    
    
    <a href="https://twitter.com/FreeTymeKiyan" target="_blank" class="icon-twitter" title="twitter"></a>
    
    
    <a href="https://www.facebook.com/kiyan.fan" target="_blank" class="icon-facebook" title="facebook"></a>
    
    
    <a href="https://www.douban.com/people/56346857" target="_blank" class="icon-douban" title="豆瓣"></a>
    
    
    
    <a href="mailto:freetymesunkiyan@gmail.com" target="_blank" class="icon-email" title="Email Me"></a>
    
  </div>
    <p class="copyright">Powered by <a href="http://zespia.tw/hexo/" target="_blank" title="hexo">hexo</a> © 2012-2017
    
    <a href="http://blog.kiyanpro.com/about" target="_blank" title="FreeTymeKiyan">FreeTymeKiyan</a>
    
    , <span class='post-count'>117.8k</span> words
    </p>
</div>
</footer>
    <script src="/js/jquery-2.0.3.min.js"></script>
<script type="text/javascript">
$(document).ready(function(){ 
  $('.navbar').click(function(){
    $('header nav').toggleClass('shownav');
  });
  var myWidth = 0;
  function getSize(){
    if( typeof( window.innerWidth ) == 'number' ) {
      myWidth = window.innerWidth;
    } else if( document.documentElement && document.documentElement.clientWidth) {
      myWidth = document.documentElement.clientWidth;
    };
  };
  var m = $('#main'),
      a = $('#asidepart'),
      c = $('.closeaside'),
      o = $('.openaside');
  $(window).resize(function(){
    getSize(); 
    if (myWidth >= 1024) {
      $('header nav').removeClass('shownav');
    }else
    {
      m.removeClass('moveMain');
      a.css('display', 'block').removeClass('fadeOut');
      o.css('display', 'none');
      
      $('#toc.toc-aside').css('display', 'none');
        
    }
  });
  c.click(function(){
    a.addClass('fadeOut').css('display', 'none');
    o.css('display', 'block').addClass('fadeIn');
    m.addClass('moveMain');
  });
  o.click(function(){
    o.css('display', 'none').removeClass('beforeFadeIn');
    a.css('display', 'block').removeClass('fadeOut').addClass('fadeIn');      
    m.removeClass('moveMain');
  });
  $(window).scroll(function(){
    o.css("top",Math.max(80,260-$(this).scrollTop()));
  });
});
</script>

<script type="text/javascript">
$(document).ready(function(){ 
  var ai = $('.article-content>iframe'),
      ae = $('.article-content>embed'),
      t  = $('#toc'),
      h  = $('article h2')
      ah = $('article h2'),
      ta = $('#toc.toc-aside'),
      o  = $('.openaside'),
      c  = $('.closeaside');
  if(ai.length>0){
    ai.wrap('<div class="video-container" />');
  };
  if(ae.length>0){
   ae.wrap('<div class="video-container" />');
  };

  c.click(function(){
    t.css('display','none');
    if(ah.length!==0){
      ta.css('display', 'block').addClass('fadeIn');
    }
  });
  o.click(function(){
    ta.css('display', 'none');
    if(ah.length!==0){
      t.css('display','block');
    }
  });

  $(window).scroll(function(){
    ta.css("top",Math.max(140,320-$(this).scrollTop()));
  });
});
</script>


<script type="text/javascript">
$(document).ready(function(){ 
  var $this = $('.share'),
      url = $this.attr('data-url'),
      encodedUrl = encodeURIComponent(url),
      title = $this.attr('data-title'),
      tsina = $this.attr('data-tsina');
  var html = [
  '<a href="#" class="overlay" id="qrcode"></a>',
  '<div class="qrcode clearfix"><span>Scan QR code and share<a class="qrclose" href="#share"></a></span><strong>Loading...Please wait</strong><img id="qrcode-pic" data-src="http://s.jiathis.com/qrcode.php?url=' + encodedUrl + '"/></div>',
  '<a href="#textlogo" class="article-back-to-top" title="Top"></a>',
  '<a href="https://www.facebook.com/sharer.php?u=' + encodedUrl + '" class="article-share-facebook" target="_blank" title="Facebook"></a>',
  '<a href="#qrcode" class="article-share-qrcode" title="QRcode"></a>',
  '<a href="https://twitter.com/intent/tweet?url=' + encodedUrl + '" class="article-share-twitter" target="_blank" title="Twitter"></a>',
  '<a href="http://service.weibo.com/share/share.php?title='+title+'&url='+encodedUrl +'&ralateUid='+ tsina +'&searchPic=true&style=number' +'" class="article-share-weibo" target="_blank" title="Weibo"></a>',
  '<span title="Share to"></span>'
  ].join('');
  $this.append(html);
  $('.article-share-qrcode').click(function(){
    var imgSrc = $('#qrcode-pic').attr('data-src');
    $('#qrcode-pic').attr('src', imgSrc);
    $('#qrcode-pic').load(function(){
        $('.qrcode strong').text(' ');
    });
  });
});     
</script>




<script type="text/javascript">

var disqus_shortname = 'FreeTymeKiyan';

(function(){
  var dsq = document.createElement('script');
  dsq.type = 'text/javascript';
  dsq.async = true;
  dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
  (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
}());
</script>






<link rel="stylesheet" href="/fancybox/jquery.fancybox.css" media="screen" type="text/css">
<script src="/fancybox/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
$(document).ready(function(){ 
  $('.article-content').each(function(i){
    $(this).find('img').each(function(){
      if ($(this).parent().hasClass('fancybox')) return;
      var alt = this.alt;
      if (alt) $(this).after('<span class="caption">' + alt + '</span>');
      $(this).wrap('<a href="' + this.src + '" title="' + alt + '" class="fancybox"></a>');
    });
    $(this).find('.fancybox').each(function(){
      $(this).attr('rel', 'article' + i);
    });
  });
  if($.fancybox){
    $('.fancybox').fancybox();
  }
}); 
</script>


<script type="text/javascript">
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');
ga('create', 'UA-60456171-1', 'auto');  
ga('send', 'pageview');
</script>


<div id="totop">
<a title="Back to Top"><img src="/img/scrollup.png"/></a>
</div>

<script src="/js/totop.js"></script>

<script type="text/x-mathjax-config"> 
MathJax.Hub.Config({ 
  tex2jax: {inlineMath: [['$','$'], ['\\(','\\)']]} 
}); 
</script>
<script type="text/javascript"
   src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>
  </body>
</html>
